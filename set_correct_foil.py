elements_dictonary = {'Sc': {'K': '4492', 'L-I': '498.0', 'L-2': '403.6', 'L-3': '398.7'},
                      'Ti': {'K': '4966', 'L-I': '560.9', 'L-2': '460.2', 'L-3': '453.8'},
                      'V': {'K': '5465', 'L-I': '626.7', 'L-2': '519.8', 'L-3': '512.1'},
                      'Cr': {'K': '5989', 'L-I': '696.0', 'L-2': '583.8', 'L-3': '574.1'},
                      'Mn': {'K': '6539', 'L-I': '769.1', 'L-2': '649.9', 'L-3': '638.7'},
                      'Fe': {'K': '7112', 'L-I': '844.6', 'L-2': '719.9', 'L-3': '706.8'},
                      'Co': {'K': '7709', 'L-I': '925.1', 'L-2': '793.2', 'L-3': '778.1'},
                      'Ni': {'K': '8333', 'L-I': '1008.6', 'L-2': '870.0', 'L-3': '852.7'},
                      'Cu': {'K': '8979', 'L-I': '1096.7', 'L-2': '952.3', 'L-3': '932.7'},
                      'Zn': {'K': '9659', 'L-I': '1196.2', 'L-2': '1044.9', 'L-3': '1021.8'},
                      'Ga': {'K': '10367', 'L-I': '1299.0', 'L-2': '1143.2', 'L-3': '1116.4'},
                      'Ge': {'K': '11103', 'L-I': '1414.6', 'L-2': '1248.1', 'L-3': '1217.0'},
                      'As': {'K': '11867', 'L-I': '1527.0', 'L-2': '1359.1', 'L-3': '1323.6'},
                      'Se': {'K': '12658', 'L-I': '1652.0', 'L-2': '1474.3', 'L-3': '1433.9'},
                      'Br': {'K': '13474', 'L-I': '1782', 'L-2': '1596', 'L-3': '1550'},
                      'Kr': {'K': '14326', 'L-I': '1921', 'L-2': '1730.9', 'L-3': '1678.4'},
                      'Rb': {'K': '15200', 'L-I': '2065', 'L-2': '1864', 'L-3': '1804'},
                      'Sr': {'K': '16105', 'L-I': '2216', 'L-2': '2007', 'L-3': '1940'},
                      'Y': {'K': '17038', 'L-I': '2373', 'L-2': '2156', 'L-3': '2080'},
                      'Zr': {'K': '17998', 'L-I': '2532', 'L-2': '2307', 'L-3': '2223'},
                      'Nb': {'K': '18986', 'L-I': '2698', 'L-2': '2465', 'L-3': '2371'},
                      'Mo': {'K': '20000', 'L-I': '2866', 'L-2': '2625', 'L-3': '2520'},
                      'Tc': {'K': '21044', 'L-I': '3043', 'L-2': '2793', 'L-3': '2677'},
                      'Ru': {'K': '22117', 'L-I': '3224', 'L-2': '2967', 'L-3': '2838'},
                      'Rh': {'K': '23220', 'L-I': '3412', 'L-2': '3146', 'L-3': '3004'},
                      'Pd': {'K': '24350', 'L-I': '3604', 'L-2': '3330', 'L-3': '3173'},
                      'Ag': {'K': '25514', 'L-I': '3806', 'L-2': '3524', 'L-3': '3351'},
                      'Cd': {'K': '26711', 'L-I': '4018', 'L-2': '3727', 'L-3': '3538'},
                      'In': {'K': '27940', 'L-I': '4238', 'L-2': '3938', 'L-3': '3730'},
                      'Sn': {'K': '29200', 'L-I': '4465', 'L-2': '4156', 'L-3': '3929'},
                      'Sb': {'K': '30491', 'L-I': '4698', 'L-2': '4380', 'L-3': '4132'},
                      'Te': {'K': '31814', 'L-I': '4939', 'L-2': '4612', 'L-3': '4341'},
                      'I': {'K': '33169', 'L-I': '5188', 'L-2': '4852', 'L-3': '4557'},
                      'Xe': {'K': '34561', 'L-I': '5453', 'L-2': '5107', 'L-3': '4786'},
                      'Cs': {'K': '35985', 'L-I': '5714', 'L-2': '5359', 'L-3': '5012'},
                      'Ba': {'K': '37441', 'L-I': '5989', 'L-2': '5624', 'L-3': '5247'},
                      'La': {'K': '38925', 'L-I': '6266', 'L-2': '5891', 'L-3': '5483'},
                      'Ce': {'K': '40443', 'L-I': '6548', 'L-2': '6164', 'L-3': '5723'},
                      'Pr': {'K': '41991', 'L-I': '6835', 'L-2': '6440', 'L-3': '5964'},
                      'Nd': {'K': '43569', 'L-I': '7126', 'L-2': '6722', 'L-3': '6208'},
                      'Pm': {'K': '45184', 'L-I': '7428', 'L-2': '7013', 'L-3': '6459'},
                      'Sm': {'K': '46834', 'L-I': '7737', 'L-2': '7312', 'L-3': '6716'},
                      'Eu': {'K': '48519', 'L-I': '8052', 'L-2': '7617', 'L-3': '6977'},
                      'Gd': {'K': '50239', 'L-I': '8376', 'L-2': '7930', 'L-3': '7243'},
                      'Tb': {'K': '51996', 'L-I': '8708', 'L-2': '8252', 'L-3': '7514'},
                      'Dy': {'K': '53789', 'L-I': '9046', 'L-2': '8581', 'L-3': '7790'},
                      'Ho': {'K': '55618', 'L-I': '9394', 'L-2': '8918', 'L-3': '8071'},
                      'Er': {'K': '57486', 'L-I': '9751', 'L-2': '9264', 'L-3': '8358'},
                      'Tm': {'K': '59390', 'L-I': '10116', 'L-2': '9617', 'L-3': '8648'},
                      'Yb': {'K': '61332', 'L-I': '10486', 'L-2': '9978', 'L-3': '8944'},
                      'Lu': {'K': '63314', 'L-I': '10870', 'L-2': '10349', 'L-3': '9244'},
                      'Hf': {'K': '65351', 'L-I': '11271', 'L-2': '10739', 'L-3': '9561'},
                      'Ta': {'K': '67416', 'L-I': '11682', 'L-2': '11136', 'L-3': '9881'},
                      'W': {'K': '69525', 'L-I': '12100', 'L-2': '11544', 'L-3': '10207'},
                      'Re': {'K': '71676', 'L-I': '12527', 'L-2': '11959', 'L-3': '10535'},
                      'Os': {'K': '73871', 'L-I': '12968', 'L-2': '12385', 'L-3': '10871'},
                      'Ir': {'K': '76111', 'L-I': '13419', 'L-2': '12824', 'L-3': '11215'},
                      'Pt': {'K': '78395', 'L-I': '13880', 'L-2': '13273', 'L-3': '11564'},
                      'Au': {'K': '80725', 'L-I': '14353', 'L-2': '13734', 'L-3': '11919'},
                      'Hg': {'K': '83102', 'L-I': '14839', 'L-2': '14209', 'L-3': '12284'},
                      'Tl': {'K': '85530', 'L-I': '15347', 'L-2': '14698', 'L-3': '12658'},
                      'Pb': {'K': '88005', 'L-I': '15861', 'L-2': '15200', 'L-3': '13035'},
                      'Bi': {'K': '90526', 'L-I': '16388', 'L-2': '15711', 'L-3': '13419'},
                      'Po': {'K': '93105', 'L-I': '16939', 'L-2': '16244', 'L-3': '13814'},
                      'At': {'K': '95730', 'L-I': '17493', 'L-2': '16785', 'L-3': '14214'},
                      'Rn': {'K': '98404', 'L-I': '18049', 'L-2': '17337', 'L-3': '14619'},
                      'Fr': {'K': '101137', 'L-I': '18639', 'L-2': '17907', 'L-3': '15031'},
                      'Ra': {'K': '103922', 'L-I': '19237', 'L-2': '18484', 'L-3': '15444'},
                      'Ac': {'K': '106755', 'L-I': '19840', 'L-2': '19083', 'L-3': '15871'},
                      'Th': {'K': '109651', 'L-I': '20472', 'L-2': '19693', 'L-3': '16300'},
                      'Pa': {'K': '112601', 'L-I': '21105', 'L-2': '20314', 'L-3': '16733'},
                       'U': {'K': '115606', 'L-I':  '21757', 'L-2': '20948', 'L-3': '17166'},}

ISS_foils= {'Sc': {'K': '4492', 'L-I': '498.0', 'L-2': '403.6', 'L-3': '398.7'},
            'Ti': {'K': '4966', 'L-I': '560.9', 'L-2': '460.2', 'L-3': '453.8'},
            'V': {'K': '5465', 'L-I': '626.7', 'L-2': '519.8', 'L-3': '512.1'},
            'Cr': {'K': '5989', 'L-I': '696.0', 'L-2': '583.8', 'L-3': '574.1'},
            'Mn': {'K': '6539', 'L-I': '769.1', 'L-2': '649.9', 'L-3': '638.7'},
            'Fe': {'K': '7112', 'L-I': '844.6', 'L-2': '719.9', 'L-3': '706.8'},
            'Co': {'K': '7709', 'L-I': '925.1', 'L-2': '793.2', 'L-3': '778.1'},
            'Ni': {'K': '8333', 'L-I': '1008.6', 'L-2': '870.0', 'L-3': '852.7'},
            'Cu': {'K': '8979', 'L-I': '1096.7', 'L-2': '952.3', 'L-3': '932.7'},
            'Zn': {'K': '9659', 'L-I': '1196.2', 'L-2': '1044.9', 'L-3': '1021.8'},
            'Se': {'K': '12658', 'L-I': '1652.0', 'L-2': '1474.3', 'L-3': '1433.9'},
            'Y': {'K': '17038', 'L-I': '2373', 'L-2': '2156', 'L-3': '2080'},
            'Zr': {'K': '17998', 'L-I': '2532', 'L-2': '2307', 'L-3': '2223'},
            'Nb': {'K': '18986', 'L-I': '2698', 'L-2': '2465', 'L-3': '2371'},
            'Mo': {'K': '20000', 'L-I': '2866', 'L-2': '2625', 'L-3': '2520'},
            'Ru': {'K': '22117', 'L-I': '3224', 'L-2': '2967', 'L-3': '2838'},
            'Rh': {'K': '23220', 'L-I': '3412', 'L-2': '3146', 'L-3': '3004'},
            'Pd': {'K': '24350', 'L-I': '3604', 'L-2': '3330', 'L-3': '3173'},
            'Ag': {'K': '25514', 'L-I': '3806', 'L-2': '3524', 'L-3': '3351'},
            'Cd': {'K': '26711', 'L-I': '4018', 'L-2': '3727', 'L-3': '3538'},
            'In': {'K': '27940', 'L-I': '4238', 'L-2': '3938', 'L-3': '3730'},
            'Sn': {'K': '29200', 'L-I': '4465', 'L-2': '4156', 'L-3': '3929'},
            'Ta': {'K': '67416', 'L-I': '11682', 'L-2': '11136', 'L-3': '9881'},
            'Re': {'K': '71676', 'L-I': '12527', 'L-2': '11959', 'L-3': '10535'},
            'Ir': {'K': '76111', 'L-I': '13419', 'L-2': '12824', 'L-3': '11215'},
            'Pt': {'K': '78395', 'L-I': '13880', 'L-2': '13273', 'L-3': '11564'},
            'Au': {'K': '80725', 'L-I': '14353', 'L-2': '13734', 'L-3': '11919'},
            'Pb': {'K': '88005', 'L-I': '15861', 'L-2': '15200', 'L-3': '13035'},
            }

element_edge_itsvalue = {}
for element in elements_dictonary.keys():
    for edge in elements_dictonary[element].keys():
        element_edge_itsvalue[element+"-"+edge] = float(elements_dictonary[element][edge])
element_edge_itsvalue_sorted = dict(sorted(element_edge_itsvalue.items(), key=lambda item: item[1]))

ISS_element_edge_itsvalue = {}
for element in ISS_foils.keys():
    for edge in ISS_foils[element].keys():
        ISS_element_edge_itsvalue[element+"-"+edge] = float(elements_dictonary[element][edge])
ISS_element_edge_itsvalue_sorted = dict(sorted(ISS_element_edge_itsvalue.items(), key=lambda item: item[1]))

ISS_foils_edges = dict([(key, value) for key,value in ISS_element_edge_itsvalue_sorted.items() if value>4500 and value<32000])

# for key, value in ISS_element_edge_itsvalue_sorted.items():
#     if value>4500 and value<30000:
#         print(key)

import pandas as pd

l3_edge = ["L3", "l3", "LIII", "L-III", "l-III", "L-3", "l-3"]
l2_edge = ["L2", "l2", "LII", "L-II", "l-II",  "L-2", "l-2"]
l1_edge = ["L1", "l1", "LI", "L-I", "l-I",  "L-1", "l-1"]
k_edge = ['k', "K"]

elements = []
edges = []
edge_value = []
for element in elements_dictonary:
    for edge in elements_dictonary[element]:
        edges.append(edge)
        elements.append(element)
        edge_value.append(float(elements_dictonary[element][edge]))

dat = pd.DataFrame([elements,edges,edge_value]).T.sort_values(2)
elements_sort = dat.loc[(dat[2]>4500) & (dat[2]<32000)]


elements = []
edges = []
edge_value = []
for element in ISS_foils:
    for edge in ISS_foils[element]:
        edges.append(edge)
        elements.append(element)
        edge_value.append(float(ISS_foils[element][edge]))

dat = pd.DataFrame([elements,edges,edge_value]).T.sort_values(2)
iss_sort = dat.loc[(dat[2]>4500) & (dat[2]<32000)]

# print(elements_dictonary['Cu']['K'])

# print(elements_sort)
# print(iss_sort)

def find_correct_foil1(element='Cu', edge="K"):
    foils_options = iss_sort.loc[(iss_sort[2] > float(elements_dictonary[element][edge]) - 200) &
                                 (iss_sort[2] < float(elements_dictonary[element][edge]) + 1000)]



    if element in ISS_foils.keys():
        print("set_foil_to_that_position")
    else:
        foils_options = iss_sort.loc[(iss_sort[2]>float(elements_dictonary[element][edge])-200) & (iss_sort[2]<float(elements_dictonary[element][edge])+1000)]
        # foils_options = dict([(key, value) for key,value in ISS_foils_edges.items() if element_edge_itsvalue_sorted[element+"-"+edge]>value-200 and element_edge_itsvalue_sorted[element+"-"+edge]<value+1000])
        # foils_options = [(key, value) for key, value in foils_options.items()]
        print(foils_options)

        # if len(foils_options)==1:
        #     print(foils_options[0][0])
        # else:
        #     print(foils_options[1][0])
# print(element_edge_itsvalue_sorted["Bi-L-3"])

# find_correct_foil("Cu", "K")

def find_correct_foil(element='Cu', edge="K"):

    if edge in l3_edge:
        edge = "L-3"
    elif edge in l2_edge:
        edge = "L-2"
    elif edge in l1_edge:
        edge = "L-I"
    elif edge in k_edge:
        edge = "K"

    foils_options = iss_sort.loc[(iss_sort[2] > float(elements_dictonary[element][edge]) - 200)
                                 & (iss_sort[2] < float(elements_dictonary[element][edge]) + 1000)]
    # print(element, edge, elements_dictonary[element][edge])
    # print(foils_options)

    if len(foils_options[0]) == 0:
        print("going to empty holder")
    indx = foils_options.index[(foils_options[0].str.contains(element)) & (foils_options[1].str.contains(edge))]
    indx_k = foils_options.index[(foils_options[1].str.contains('K'))]
    indx_l3 = foils_options.index[(foils_options[1].str.contains('L-3'))]
    indx_l2 = foils_options.index[(foils_options[1].str.contains('L-2'))]
    indx_l1 = foils_options.index[(foils_options[1].str.contains('L-I'))]

    if len(indx) == 1:
        print(foils_options.loc[[indx[0]]])
    elif len(indx_k) >= 1:
        print(foils_options.loc[[indx_k[0]]])
    elif len(indx_l3) >= 1:
        print(foils_options.loc[[indx_l3[0]]])
    elif len(indx_l2) >= 1:
        print("going to empty holder")
        # print(foils_options.loc[[indx_l2[0]]])
    elif len(indx_l1) >= 1:
        print("going to empty holder")
        # print(foils_options.loc[[indx_l1[0]]])





# for key in elements_dictonary.keys():
#     for edge in elements_dictonary[key].keys():
#         print(key, elements_dictonary[key][edge])
#         find_correct_foil2(element=key, edge=edge)


# find_correct_foil(element='Bi', edge='L3')

re_indx_element = elements_sort
re_indx_element = re_indx_element.reset_index(drop=True)

for i in range(len(elements_sort[0])):
    print("Desired element: ", re_indx_element[0][i], ", Desired Edge: ", re_indx_element[1][i], ", edge value: ", re_indx_element[2][i])
    find_correct_foil(element=str(re_indx_element[0][i]), edge=str(re_indx_element[1][i]))